#!/bin/bash

DIR=$(cd "$(dirname "$0")"; pwd)
if [ ! -d "$DIR/libde265" ]; then
  git clone https://github.com/strukturag/libde265.git
fi

cd libde265
git reset --hard c43f2f8cd674bc7c78951b279ca0b1f883e1f276
./autogen.sh
./configure   \
  CC=$SHADOWBOUND/llvm-project/build/bin/clang \
  CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
  CFLAGS="-g -fsanitize=overflow-defense" \
  CXXFLAGS="-g -fsanitize=overflow-defense"

make clean
make -j`nproc`
# ./libde265/dec265/dec265 libde265-ff_hevc_put_unweighted_pred_8_sse-heap_overflow.crash
