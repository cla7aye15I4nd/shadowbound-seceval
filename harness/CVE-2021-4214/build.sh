#!/bin/bash

DIR=$(cd "$(dirname "$0")"; pwd)
if [ ! -d "$DIR/libde265" ]; then
  git clone https://github.com/glennrp/libpng.git
fi

cd libpng
git reset --hard 301f7a1

./autogen.sh
./configure \
  CC=$SHADOWBOUND/llvm-project/build/bin/clang \
  CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
  CFLAGS="-g -fsanitize=overflow-defense" \
  CXXFLAGS="-g -fsanitize=overflow-defense" \
  --disable-shared

make clean
make -j`nproc`
# cp ./input ./libpng/ && cd libpng && ./pngimage input
