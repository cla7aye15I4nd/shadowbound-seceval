#!/bin/bash

DIR=$(cd "$(dirname "$0")"; pwd)
if [ ! -d "$DIR/htmldoc" ]; then
  git clone https://github.com/michaelrsweet/htmldoc.git
fi

cd htmldoc 

if [ ! -f poc7.zip ]; then
  wget https://github.com/michaelrsweet/htmldoc/files/5872217/poc7.zip
  unzip poc7.zip
fi

git reset --hard 6898d0a29da923702a1895fbbff7bba2910c54fb

./configure \
CC=$SHADOWBOUND/llvm-project/build/bin/clang \
CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
CFLAGS="-g -fsanitize=overflow-defense" \
CXXFLAGS="-g -fsanitize=overflow-defense" \
LDFLAGS="-g -fsanitize=overflow-defense" \
--disable-shared

make clean
make -j`nproc`
# cd htmldoc && ./htmldoc/htmldoc -f demo.pdf poc7.html

