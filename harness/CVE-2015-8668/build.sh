#!/bin/bash

if [ ! -d "tiff-4.0.1" ]; then
	tar -xvf tiff-4.0.1.tar.gz
fi

pushd tiff-4.0.1


CC=$SHADOWBOUND/llvm-project/build/bin/clang \
CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
CFLAGS="-fsanitize=overflow-defense" \
CXXFLAGS="-fsanitize=overflow-defense" \
./configure --disable-shared

make -j`nproc`

popd

# ./tiff-4.0.1/tools/bmp2tiff ./libtiff-poc.bmp out.tif

