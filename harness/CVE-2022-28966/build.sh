#!/bin/bash

DIR=$(cd "$(dirname "$0")"; pwd)
if [ ! -d "$DIR/wasm3" ]; then
  git clone https://github.com/wasm3/wasm3.git
fi

cd wasm3
git reset --hard v0.5.0

if [ -d build ]; then
  rm -rf build
fi

mkdir -p build && cd build

CC=$SHADOWBOUND/llvm-project/build/bin/clang \
CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
CFLAGS="-fsanitize=overflow-defense" \
CXXFLAGS="-fsanitize=overflow-defense" \
cmake ..

make
