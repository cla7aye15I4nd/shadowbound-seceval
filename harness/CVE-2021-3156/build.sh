# test in ubuntu:18.04

if [ ! -d "./sudo-1.8.21" ]; then
  unzip ./sudo-1.8.21.zip
fi
if [ ! -d "./exp" ]; then
  unzip ./exp.zip
fi

cd sudo-1.8.21

./configure \
  CC=$SHADOWBOUND/llvm-project/build/bin/clang \
  CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
  CFLAGS="-g -fsanitize=overflow-defense" \
  CXXFLAGS="-g -fsanitize=overflow-defense" \
  LDFLAGS="-fsanitize=overflow-defense" \
  --disable-shared

make clean
make -j`nproc`
cd ../exp
# modify the execve path in exp.c:main()
gcc exp.c -o exp -lm
