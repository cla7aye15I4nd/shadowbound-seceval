#!/bin/bash

DIR=$(cd "$(dirname "$0")"; pwd)
if [ ! -d "$DIR/php-src" ]; then
  git clone https://github.com/php/php-src.git
fi

cd php-src
git reset --hard 4653a1b260c9d640a292a9548e8def00edc5ca58

./buildconf --force

./configure \
  CC=$SHADOWBOUND/llvm-project/build/bin/clang \
  CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
  CFLAGS="-g -fsanitize=overflow-defense" \
  CXXFLAGS="-g -fsanitize=overflow-defense"

make
