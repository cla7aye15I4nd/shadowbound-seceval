#!/bin/bash

DIR=$(cd "$(dirname "$0")"; pwd)
if [ ! -d "$DIR/libde265" ]; then
  git clone https://github.com/strukturag/libde265.git
fi

cd libde265
git reset --hard a3f1c6a0dea2b0d4a531255ad06ed40cdb184d25^

./autogen.sh
./configure   \
  CC=$SHADOWBOUND/llvm-project/build/bin/clang \
  CXX=$SHADOWBOUND/llvm-project/build/bin/clang++ \
  CFLAGS="-g -fsanitize=overflow-defense" \
  CXXFLAGS="-g -fsanitize=overflow-defense" \

make clean
make -j`nproc`
# ./libde265/dec265/dec265 libde265-mc_luma-heap_overflow.crash
